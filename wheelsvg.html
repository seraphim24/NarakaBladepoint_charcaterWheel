<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Wheel Test</title>
        <style>
            body {
                margin: 0;
                display: flex;
                background-color: #725c5c;
                justify-content: center;
                align-items: center;
                height: 100vh;
            }

            path {
                background-color: red;
            }
            svg image {
                transform-box: fill-box;
            }
        </style>
    </head>
    <body>
        <section id="wheel-wrapper"></section>

        <script>
            const viewBoxSize = 500;
            const wheel = initSVG(750, 750, "wheel-wrapper");

            const data = [
                { label: "Viper", image: "./assets/img/full/lannie.png" },
                { label: "Feria", image: "./assets/img/full/lannie.png" },
                { label: "Tianhai", image: "./assets/img/full/lannie.png" },
                { label: "Ziping", image: "./assets/img/full/lannie.png" },
                { label: "Temulch", image: "./assets/img/full/lannie.png" },
                { label: "Tarka", image: "./assets/img/full/lannie.png" },
                { label: "Kurumi", image: "./assets/img/full/lannie.png" },
                { label: "Yoto", image: "./assets/img/full/lannie.png" },
                { label: "Valda", image: "./assets/img/full/lannie.png" },
                { label: "Yueshan", image: "./assets/img/full/lannie.png" },
                { label: "Wuchen", image: "./assets/img/full/lannie.png" },
                { label: "Justina", image: "./assets/img/full/lannie.png" },
                { label: "Takeda", image: "./assets/img/full/lannie.png" },
                { label: "Matari", image: "./assets/img/full/lannie.png" },
                { label: "Akos", image: "./assets/img/full/lannie.png" },
                { label: "ZaÃ¯", image: "./assets/img/full/lannie.png" },
                { label: "Tessa", image: "./assets/img/full/lannie.png" },
                { label: "Hadi", image: "./assets/img/full/lannie.png" },
                { label: "Shayol", image: "./assets/img/full/lannie.png" },
                { label: "Lyam", image: "./assets/img/full/lannie.png" },
                { label: "Kylin", image: "./assets/img/full/lannie.png" },
                { label: "Cyra", image: "./assets/img/full/lannie.png" },
                { label: "Lannie", image: "./assets/img/full/lannie.png" },
            ];

            createWheel(data);

            function initSVG(height = 750, width = 750, container = null) {
                const wheel = createSvgElement("svg", { id: "wheel", height, width, viewBox: `0 0 ${viewBoxSize} ${viewBoxSize}` });
                !container ? document.body.appendChild(wheel) : document.getElementById(container).appendChild(wheel);
                return wheel;
            }

            /**
             * @param {object[]} characters
             */
            function createWheel(characters) {
                wheel.innerHTML = ""; // Reset html

                const center = Math.floor(viewBoxSize / 2),
                    radius = Math.floor(viewBoxSize / 2) - 10,
                    anglePerSection = 360 / characters.length;

                // Background
                wheel.appendChild(createSvgElement("circle", { cx: center, cy: center, r: radius, fill: "none", stroke: "#222", "stroke-width": 5 }));

                // Section
                characters.forEach((character, i) => {
                    if (i > 0) return;
                    const startAngle = i * anglePerSection;
                    const endAngle = startAngle + anglePerSection;
                    const largeArc = anglePerSection > 180 ? 1 : 0;

                    const [x1, y1] = polarToCartesian(center, radius, startAngle);
                    const [x2, y2] = polarToCartesian(center, radius, endAngle);

                    const gradientId = `section-${i}`;
                    const clipId = `clip-${i}`;

                    // Create a rotating linear gradient for this slice
                    createGradient({
                        id: gradientId,
                        type: "linear",
                        attributes: {
                            x1: center,
                            y1: center,
                            x2: x2,
                            y2: y2,
                            gradientUnits: "userSpaceOnUse",
                        },
                        stops: [
                            { offset: "50%", color: "black", opacity: 1 },
                            { offset: "100%", color: "black", opacity: 0 },
                        ],
                    });

                    const pathData = [`M ${center} ${center}`, `L ${x1} ${y1}`, `A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2}`, "Z"].join(" ");

                    // Image
                    wheel.appendChild(
                        createSvgElement("image", {
                            href: character.image,
                            height: radius - Math.floor(radius * 0.2),
                            x: x1 - radius,
                            y: y1 - radius,
                            transform: `rotate(${90 + startAngle})`,
                            "transform-origin": "center",
                        })
                    );

                    wheel.appendChild(createSvgElement("path", { d: pathData, fill: `url(#${gradientId})`, stroke: "#222", "stroke-width": 2 }));

                    // ----------- Text -------------
                    const midAngle = startAngle + anglePerSection / 2;
                    const [textX, textY] = polarToCartesian(center, radius * 0.625, midAngle);

                    wheel.appendChild(
                        createSvgElement(
                            "text",
                            {
                                x: textX,
                                y: textY,
                                transform: `rotate(${midAngle}, ${textX}, ${textY})`,
                                "text-anchor": "middle",
                                "dominant-baseline": "middle",
                                fill: "white",
                                "font-size": "12",
                            },
                            [],
                            character.label
                        )
                    );
                });
            }

            function polarToCartesian(center, radius, angle) {
                const rad = (angle * Math.PI) / 180;
                return [center + radius * Math.cos(rad), center + radius * Math.sin(rad)];
            }

            function createSvgElement(tag, attrs = {}, children = [], textContent = "") {
                const el = document.createElementNS("http://www.w3.org/2000/svg", tag);
                Object.entries(attrs).forEach(([key, value]) => el.setAttribute(key, value));
                (Array.isArray(children) ? children : [children]).forEach((child) => {
                    if (child) el.appendChild(child);
                });
                if (textContent) el.textContent = textContent;
                return el;
            }

            function createGradient({ id, type = "linear", stops = [], attributes = {}, svg = wheel }) {
                let defs = svg.querySelector("defs");
                if (!defs) {
                    defs = createSvgElement("defs");
                    svg.appendChild(defs);
                }

                if (svg.querySelector(`#${id}`)) return;

                const tag = type === "linear" ? "linearGradient" : "radialGradient";
                const gradientAttrs = {
                    id,
                    ...attributes,
                };

                const gradient = createSvgElement(tag, gradientAttrs);

                stops.forEach(({ offset, color, opacity }) => {
                    const stopAttrs = {
                        offset,
                        "stop-color": color,
                    };
                    if (opacity !== undefined) {
                        stopAttrs["stop-opacity"] = opacity;
                    }
                    gradient.appendChild(createSvgElement("stop", stopAttrs));
                });

                defs.appendChild(gradient);
            }
        </script>
    </body>
</html>
